<?phpinclude_once(dirname(__FILE__) . '/DBconnection.php');class User extends DBconnection {    private $id;    private $name;    private $userType;    private $email;    private $createdAt;    private $isActive;    private $authToken;    private $lastLogin;    private $username;    private $image_name;    private $resetCode;    private $password;    public function __construct() {        parent::__construct();    }    public function create() {        date_default_timezone_set('Asia/Colombo');        $createdAt = date('Y-m-d H:i:s');        $sql = "INSERT INTO `user` (name, email,user_type,createdAt, isActive, username, password) VALUES  ("                . "'" . $this->name . "', '"                . $this->email . "', '"                . $this->userType . "', '"                . $this->createdAt . "', '"                . 1 . "', '"                . $this->username . "', '"                . $his->enPass . "')";        if (mysqli_query($this->connection, $sql)) {            return TRUE;        } else {            return FALSE;        }    }    public function Login() {        $sql = "SELECT id FROM user WHERE username = '$this->username' AND password = '$this->password' AND userType='$this->userType' ";        $query = mysqli_query($this->connection, $sql);        $result = $query->fetch_assoc();        //  echo $id;        if (mysqli_num_rows($query) > 0) {            $this->id = $result['id'];            $this->setAuthToken($result['id']);            $this->setLastLogin($this->id);            $user = $this->getterAllById($this->id);            $this->setUserSession($user);            return $user;        } else {            return FALSE;        }    }    private function setAuthToken($id) {        $authToken = md5(uniqid(rand(), true));        $sql = "UPDATE `user` SET `authToken` ='" . $authToken . "' WHERE `id`='" . $id . "'";        $result = mysqli_query($this->connection, $sql);        if ($result) {            return $authToken;        } else {            return FALSE;        }    }    private function setLastLogin($id) {        date_default_timezone_set('Asia/Colombo');        $now = date('Y-m-d H:i:s');        $sql = "UPDATE `user` SET `lastLogin` ='" . $now . "' WHERE `id`='" . $id . "'";        $result = mysqli_query($this->connection, $sql);        if ($result) {            return TRUE;        } else {            return FALSE;        }    }    private function setUserSession($user) {        if (!isset($_SESSION)) {            session_start();        }        $_SESSION["id"] = $user['id'];        $_SESSION["name"] = $user['name'];        $_SESSION["userType"] = $user['userType'];        $_SESSION["email"] = $user['email'];        $_SESSION["isActive"] = $user['isActive'];        $_SESSION["authToken"] = $user['authToken'];        $_SESSION["lastLogin"] = $user['lastLogin'];        $_SESSION["username"] = $user['username'];    }    public function authenticate() {        if (!isset($_SESSION)) {            session_start();        }        $id = NULL;        $authToken = NULL;        if (isset($_SESSION["id"])) {            $id = $_SESSION["id"];        }        if (isset($_SESSION["authToken"])) {            $authToken = $_SESSION["authToken"];        }        $sql = "SELECT `id` FROM `user` WHERE `id`= '" . $id . "' AND `authToken`= '" . $authToken . "'";        $query = mysqli_query($this->connection, $sql);        $result = $query->fetch_assoc();                       if (!$result) {            return FALSE;        } else {            return TRUE;        }    }    public function logOut() {        if (!isset($_SESSION)) {            session_start();        }        unset($_SESSION["id"]);        unset($_SESSION["name"]);        unset($_SESSION["email"]);        unset($_SESSION["isActive"]);        unset($_SESSION["authToken"]);        unset($_SESSION["lastLogin"]);        unset($_SESSION["username"]);        return TRUE;    }    //Setters    public function setId($id) {        $this->id = $id;    }    function setLoginCredentials($username, $password, $type) {        $this->username = $username;        $this->password = $password;        $this->userType = $type;    }    // Getters    public function getName() {        return $this->userName;    }    public function getterAllById($id) {        if ($id) {            $sql = "SELECT * FROM `user` WHERE `id`=" . $id;            $query = mysqli_query($this->connection, $sql);            $result = $query->fetch_assoc();            $this->id = $result['id'];            $this->name = $result['name'];            $this->userType = $result['userType'];            $this->email = $result['email'];            $this->createdAt = $result['createdAt'];            $this->isActive = $result['isActive'];            $this->lastLogin = $result['lastLogin'];            $this->username = $result['username'];            $this->authToken = $result['authToken'];            $this->resetCode = $result['resetcode'];            $this->image_name = $result['image_name'];            return $result;        }    }}